# Прошивка произвольного модуля ESP8266 для работы с FB 4S

## Что это и зачем

Это инструкция как прошить произвольный модуль ESP8266 для работы с 3D принтером FB 4S

## Какой модуль подойдет

Подойдет любой модуль на ESP8266 с объемом flash не менее 4Мб на котором разведены следующие пины:

* RST
* IO0
* IO4

## Схема подключения

Тут картинка со схемой

## Что прошивать

Модуль прошивается стандартной прошивкой которая идет в комплекте с прошивкой принтера (файл MksWifi.bin).
Кроме этого надо прошить 21 байт с ID. В оригинальном модуле этот ID содержит MAC адрес модуля, но как показала практика, можно забить MAC нулями (символ 0, hex 0x30) и все будет работать.

## Как прошить

Прошить стандартную прошивку можно через сам принтер, с SD карты как обычно. Но поскольку надо прошить еще дополнительно ID, модуль все равно надо подключать к компьютеру. Поэтому проще прошить все сразу, одни заходом.
Для прошивки используется esptool и SDK от Espressif. Если вы используете для прошивки ESP среду Arduino IDE то у вас уже есть этам программа. Если вы используете для прошивки ESP среду Platformio, то у вас уже есть эта программа. Если вы используете SDK от Espressif для ESP8266 или ESP32, то у вас уже есть эта программа. Просто поищите ее на диске. Если ничего из вышеперечисленного вы не используете, то [esptool](https://github.com/espressif/esptool)
Команда для прошивки:
**esptool.py -p /dev/ttyUSB0 -b 921600 write_flash --erase-all 0x0 MksWifi.bin 0x3fb0c0 21byte.bin**

Параметры:

* **-p /dev/ttyUSB0** Используемый COM-порт. Если у вас Windows, поставьте тут нужный порт, например COM5. Параметр можно опустить, программа сама попытаеся найти нужный порт.
* **-b 921600** Скорость передачи по UART. Если модуль подключен "на сполях", можно поставить меньше или совсем убрать.
* **write_flash** команда. Будем писать во flash
* **--erase-all** предварительно стереть flash
* **0x0 MksWifi.bin** с адреса 0x0 прошить MksWifi.bin
* **0x3fb0c0 21byte.bin** с адреса 0x3fb0c0 прошить 21byte.bin
